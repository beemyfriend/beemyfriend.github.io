<head>
    <script src = 'd3.js'></script>
</head>
<body>
    <div id = 'laptops'></div>
    <script>
        var width = 1000,
            height = 600,
            margin = {
                left: 100,
                top: 50,
                right:50,
                bottom: 100
            };
        
        var continents = ["Africa", "Asia", "Central America", "Europe", 
                          "Oceania", "South America", 'None']
        
        var continentSpacing = [];
        
        for(var i = 0; i < continents.length; i++){
            var tot_width = width- margin.right - margin.left;
            var spacing = tot_width/(continents.length);
            continentSpacing.push(margin.left + (i * spacing))
        }
        
        var rangeSpacing = [];
        
        for(var i = 0; i< 4; i++){
            var tot_width = width- margin.right - margin.left;
            var spacing = tot_width/4;
            rangeSpacing.push(margin.left + (i * spacing))
        }
        
        var colors = ['#8dd3c7', '#ffffb3', '#fdb462', '#80b1d3',  
                      '#b3de69', '#fccde5', 'grey']
        
        var svg = d3.select('#laptops')
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        var projection = d3.geoMercator()
            .scale(width/2/Math.PI)
            .translate([width/2, height/2]);
        
        var path = d3.geoPath()
            .projection(projection);
        
        var r_count = d3.scaleLog()
            .range([3, 30]);
        
        var r_countxpop = d3.scaleLog()
            .range([3, 30]);
        
        var x_continent = d3.scaleOrdinal()
            .domain(continents)
            .range(continentSpacing)
        
        var x_ranges = d3.scaleOrdinal()
            .range(rangeSpacing)
            .domain('Low', 'Average', 'High', 'Not Available')
        
        var y_count = d3.scaleLinear()
            .range([height-margin.bottom, margin.top])
        
        var y_countxpopulation = d3.scaleLinear()
            .range([height-margin.bottom, margin.top])
        
        var clr = d3.scaleOrdinal()
            .range(colors)
            .domain(continents)
        
        var map;
        var data;
        var scrollFunctions;
        
        d3.queue()
            .defer(d3.json, 'worldmap.countries.geo.json')
            .defer(d3.csv, 'laptops.csv')
            .await(ready)
        
        function ready(error, geojson, csv){
            
            function findContinent(country){
                var involved = csv.filter(function(x){return x.country == country});
                if(involved.length != 0){
                    return involved[0].Continent
                } else {
                    return 'None'
                }
            }
            
            geojson.features
                .map(function(x){return x.properties.continent = findContinent(x.properties.name);});
                        
            map = geojson;
            data = csv;
            
            y_count.domain(d3.extent(csv.map(function(d){return +d.count})));
            y_countxpopulation.domain(csv.map(function(d){return +d.countxpopulation}))
            r_count.domain(d3.extent(csv.map(function(d){return +d.count})));
            r_countxpop.domain(d3.extent(csv.map(function(d){return +d.countxpopulation})))
            
            function countxcontinent(){
                svg.selectAll('circle')
                    .remove()
                    .data(csv)
                    .enter().append('circle')
                    .attr('cx', function(d){return x_continent(d.Continent)})
                    .attr('cy', function(d){return y_count(+d.count)})
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', function(d){return r_count(+d.count)})
                    .attr('stroke', 'black');}
            
            function countxpopulationxliteracy(){
                svg.selectAll('circle')
                    .remove()
                    .data(csv)
                    .enter().append('circle')
                    .attr('cx', function(d){return x_ranges(d.literacyrange)})
                    .attr('cy', function(d){return y_countxpopulation(+d.countxpopulation)})
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', function(d){return r_count(+d.count)})
                    .attr('stroke', 'black');}
            
            function countxpopulationxunemployment(){
                svg.selectAll('circle')
                    .remove()
                    .data(csv)
                    .enter().append('circle')
                    .attr('cx', function(d){return x_ranges(d.unemploymentrange)})
                    .attr('cy', function(d){return y_countxpopulation(+d.countxpopulation)})
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', function(d){return r_count(+d.count)})
                    .attr('stroke', 'black');   }                     
            
            function contxpopulationxcontinent(){
                svg.selectAll('circle')
                    .remove()
                    .data(csv)
                    .enter().append('circle')
                    .attr('cx', function(d){return x_continent(d.Continent)})
                    .attr('cy', function(d){return y_countxpopulation(+d.countxpopulation)})
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', function(d){return r_count(+d.count)})
                    .attr('stroke', 'black');}
            
            function continentxgeolocated(){
                svg.selectAll('path')
                    .remove()
                    .data(geojson.features)
                    .enter().append('path')
                    .attr('d', path)
                    .attr('fill', function(d){return clr(d.properties.continent)})
                    .attr('fill-opacity', 1)
                    .attr('stroke', 'black')
                    .attr('stroke-width', 1)}
            
            function countxgeolocated(){ 
                svg.selectAll('circle')
                    .remove()
                    .data(csv).enter()
                    .append('circle')
                    .attr('cx', function(d){return projection([d.longitude, d.latitude])[0]; })
                    .attr('cy', function(d){return projection([d.longitude, d.latitude])[1]; })
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', function(d){return r_count(+d.count)})
                    .attr('stroke', 'black')}

            function countxpopulationxgeolocated(){
                svg.selectAll('circle')
                    .remove()
                    .data(csv).enter()
                    .append('circle')
                    .attr('cx', function(d){return projection([d.longitude, d.latitude])[0]; })
                    .attr('cy', function(d){return projection([d.longitude, d.latitude])[1]; })
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', function(d){return r_countxpop(+d.countxpopulation)})
                    .attr('stroke', 'black')}
            
            scrollFunctions = [countxcontinent, 
             countxpopulationxliteracy, 
             countxpopulationxunemployment, 
             contxpopulationxcontinent, 
             continentxgeolocated, 
             countxgeolocated, 
             countxpopulationxgeolocated]
        }
        
    </script>
</body>