<head>
    <script src = 'd3.js'></script>
</head>
<body>
    <div id = 'laptops'></div>
    <script>
        var width = 1000,
            height = 600;
        
        var continents = ["Africa", "Asia", "Australia",
                          "Central America", "Europe", "North America", 
                          "Oceania", "South America", 'None']
        
        var colors = ['#8dd3c7', '#ffffb3', '#bebada', 
                      '#fb8072', '#80b1d3', '#fdb462',
                      '#b3de69', '#fccde5', 'grey']
        
        var svg = d3.select('#laptops')
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        var projection = d3.geoMercator()
            .scale(width/2/Math.PI)
            .translate([width/2, height/2]);
        
        var path = d3.geoPath()
            .projection(projection);
        
        var r = d3.scaleLog()
            .range([3, 30]);
        
        var clr = d3.scaleOrdinal()
            .range(colors)
            .domain(continents)
        
        var map;
        var data;
        
        d3.queue()
            .defer(d3.json, 'worldmap.countries.geo.json')
            .defer(d3.csv, 'laptops.csv')
            .await(ready)
        
        function ready(error, geojson, csv){
            
            function findContinent(country){
                var involved = csv.filter(function(x){return x.country == country});
                if(involved.length != 0){
                    return involved[0].Continent
                } else {
                    return 'None'
                }
            }
            
            geojson.features
                .map(function(x){return x.properties.continent = findContinent(x.properties.name);});
            
            map = geojson;
            
            svg.selectAll('path')
                .data(geojson.features)
                .enter().append('path')
                .attr('d', path)
                .attr('fill', function(d){return clr(d.properties.continent)})
                .attr('fill-opacity', 1)
                .attr('stroke', 'black')
                .attr('stroke-width', 1)
            
            data = csv;
            
            r.domain(d3.extent(csv.map(function(d){return +d.count})));
            
            svg.selectAll('circle')
                .data(csv).enter()
                .append('circle')
                .attr('cx', function(d){return projection([d.longitude, d.latitude])[0]; })
                .attr('cy', function(d){return projection([d.longitude, d.latitude])[1]; })
                .attr('fill', function(d){return clr(d.Continent)})
                .attr('fill-opacity', 1)
                .attr('r', function(d){return r(d.count)})
                .attr('stroke', 'black')
        }
        
    </script>
</body>