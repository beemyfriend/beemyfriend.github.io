<head>
    <script src = 'd3.js'></script>
    <style>
        #sections > div{
            opacity: .3;
        }
        
        #sections div.graph-scroll-active{
            opacity: 1;
        }
        
        #container{
            position: relative;
            overflow: auto;
        }
        
        #sections{
            width: 10px;
            float: left;
        }
        
        #graph{
            float: left;
            margin-left: 10px;
        }
        
        #graph.graph-scroll-fixed{
            position: fixed;
            top: 0px;
            margin-left: 10;
        }
        body{
            background-color: whitesmoke;
        }
        svg{
            background-color: none;
            position: absolute;
            top:0px;
            left: 0px;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div id = 'container'>
        <div id = 'sections'>
            <div>
                <h3>0</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>                
            </div>
            <div>
                <h3>1</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>                
            </div>
            <div>
                <h3>2</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>                
            </div>
            <div>
                <h3>3</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>                
            </div>
            <div>
                <h3>4</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>                
            </div>
            <div>
                <h3>5</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>                
            </div>
            <div>
                <h3>6</h3>
                <br><br><br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br><br><br>  
                <br><br><br><br><br><br><br><br><br><br>
            </div>
        </div>
        <div id = 'graph'></div>
    </div>
    

    <script src = 'd3.js'></script>
    <script src = 'graph-scroll.js'></script>
    <script src = 'd3-annotation.js'></script>    
    <script>
        var width = 1000,
            height = 600,
            margin = {
                left: 50,
                top: 100,
                right:50,
                bottom: 50
            };
        
        var continents = ["Africa", "Asia", "Central America", "Europe", 
                          "Oceania", "South America", 'None']
        
        var continentSpacing = [];
        
        for(var i = 0; i < continents.length; i++){
            var tot_width = width- margin.right - margin.left - 50;
            var spacing = tot_width/(continents.length);
            continentSpacing.push(margin.left + 50 +((i+1) * spacing))
        }
        
        var rangeSpacing = [];
        
        for(var i = 0; i< 4; i++){
            var tot_width = width- margin.right - margin.left - 50;
            var spacing = tot_width/4;
            rangeSpacing.push(margin.left + 50 + ((i+1) * spacing))
        }
        
        var colors = ['#8dd3c7', '#ffffb3', '#fdb462', '#80b1d3',  
                      '#b3de69', '#fccde5', 'grey']
        
        var colorsBinary = ['lightgrey', 'lightgrey', 'lightgrey', 'lightgrey',
                           'lightgrey', 'lightgrey', 'grey']
        
        var svg = d3.select('#graph')
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        var projection = d3.geoMercator()
            .scale(width/2/Math.PI)
            .translate([width/2, height/2]);
        
        var path = d3.geoPath()
            .projection(projection);
        
        var r_count = d3.scaleLog()
            .range([3, 30]);
        
        var r_countxpop = d3.scaleLog()
            .range([3, 30]);
        
        var x_continent = d3.scaleOrdinal()
            .domain(continents)
            .range(continentSpacing)
        
        var x_ranges = d3.scaleOrdinal()
            .range(rangeSpacing)
            .domain('Low', 'Average', 'High', 'Not Available')
        
        var y_count = d3.scaleLog()
            .range([height-margin.bottom, margin.top])
        
        var y_countxpopulation = d3.scaleLog()
            .range([height-margin.bottom, margin.top])
        
        var clr = d3.scaleOrdinal()
            .range(colors)
            .domain(continents);

        var clrBinary = d3.scaleOrdinal()
            .range(colorsBinary)
            .domain(continents);   
        
        var leftCountAxis = d3.axisLeft(y_count);
        var leftCountxpopulationAxis = d3.axisLeft(y_countxpopulation);
        var bottomContinentAxis = d3.axisBottom(x_continent);
        var bottomRangesAxis = d3.axisBottom(x_ranges)

        
        var map;
        var data;
        var scrollFunctions;
        var gs;
        
        d3.queue()
            .defer(d3.json, 'worldmap.countries.geo.json')
            .defer(d3.csv, 'laptops.csv')
            .await(ready)
        
        function ready(error, geojson, csv){
            
            function findContinent(country){
                var involved = csv.filter(function(x){return x.country == country});
                if(involved.length != 0){
                    return involved[0].Continent
                } else {
                    return 'None'
                }
            }
            
            geojson.features
                .map(function(x){return x.properties.continent = findContinent(x.properties.name);});
                        
            map = geojson;
            data = csv;
            
            y_count.domain(d3.extent(csv.map(function(d){return +d.count})));
            y_countxpopulation.domain(csv.map(function(d){return +d.countxpopulation}))
            r_count.domain(d3.extent(csv.map(function(d){return +d.count})));
            r_countxpop.domain(d3.extent(csv.map(function(d){return +d.countxpopulation})))
            
            function countxcontinent(){
                
                svg.selectAll('g')
                    .remove()
                
                svg.selectAll('path')
                    .attr('fill', 'white')
                    .attr('stroke', 'white');
                
                svg.selectAll('circle')
                    .transition().duration(1000)
                    .attr('cx', function(d){return x_continent(d.Continent)})
                    .attr('cy', function(d){return y_count(+d.count)});
                
                svg.append('g')
                    .attr('transform', 'translate(' + 0 + ',' + (height - margin.bottom/2) + ')')
                    .call(bottomContinentAxis);
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',' + 0 + ')')
                    .call(leftCountAxis)
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',50)')
                    .append('text')
                    .attr('font-size', 20)
                    .text('Computers Given Sorted by Continent')
                

            }
            
            function countxpopulationxliteracy(){
                
                svg.selectAll('g')
                    .remove()
                
                svg.selectAll('circle')
                    .transition().duration(1500)
                    .attr('cx', function(d){return x_ranges(d.literacyrange)})
                    .attr('cy', function(d){return y_countxpopulation(+d.countxpopulation)});
                
                svg.append('g')
                    .attr('transform', 'translate(' + 0 + ',' + (height - margin.bottom/2) + ')')
                    .call(bottomRangesAxis);
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',' + 0 + ')')
                    .call(leftCountxpopulationAxis)
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',50)')
                    .append('text')
                    .attr('font-size', 20)
                    .text('Computers Given (%population) Sorted by Literacy Rate')
                    
            }
            
            function countxpopulationxunemployment(){
                
                svg.selectAll('g')
                    .remove()
                
                svg.selectAll('circle')
                    .transition().duration(1500)
                    .attr('cx', function(d){return x_ranges(d.unemploymentrange)})
                    .attr('cy', function(d){return y_countxpopulation(+d.countxpopulation)});
                            
                svg.append('g')
                    .attr('transform', 'translate(' + 0 + ',' + (height - margin.bottom/2) + ')')
                    .call(bottomRangesAxis);
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',' + 0 + ')')
                    .call(leftCountxpopulationAxis)
            
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',50)')
                    .append('text')
                    .attr('font-size', 20)
                    .text('Computers Given (%population) Compared to Unemployment Rate')    
            }                     
            
            function contxpopulationxcontinent(){
                
                svg.selectAll('g')
                    .remove()
                
                svg.selectAll('circle')
                    .transition().duration(1500)
                    .attr('cx', function(d){return x_continent(d.Continent)})
                    .attr('cy', function(d){return y_countxpopulation(+d.countxpopulation)});
            
                svg.append('g')
                    .attr('transform', 'translate(' + 0 + ',' + (height - margin.bottom/2) + ')')
                    .call(bottomContinentAxis);
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',' + 0 + ')')
                    .call(leftCountxpopulationAxis)
                
                svg.append('g')
                    .attr('transform', 'translate(' + margin.left + ',50)')
                    .append('text')
                    .attr('font-size', 20)
                    .text('Computers Given (%population) Sorted by Continent')
                
            }
            
            function continentxgeolocated(){
                
                svg.selectAll('g')
                    .remove();
                
                svg.selectAll('path')
                    .transition().duration(1500)
                    .attr('fill', function(d){return clr(d.properties.continent)})
                    .attr('stroke', 'black');
                
                svg.selectAll('circle')
                    .transition().duration(1500)
                    .attr('r', 0);

            }
                
            
            
            function countxgeolocated(){ 
                
                svg.selectAll('g')
                    .remove()
                
                svg.selectAll('path')
                    .transition().duration(1500)
                    .attr('fill', function(d){return clrBinary(d.properties.continent)})
                
                svg.selectAll('circle')
                    .transition().duration(1500)
                    .attr('r', function(d){return r_count(+d.count)})
                    }

            function countxpopulationxgeolocated(){
                
                svg.selectAll('g')
                    .remove()
                
                svg.selectAll('circle')
                    .transition().duration(1500)
                    .attr('cx', function(d){return projection([d.longitude, d.latitude])[0]; })
                    .attr('cy', function(d){return projection([d.longitude, d.latitude])[1]; })
                    .attr('r', function(d){return r_countxpop(+d.countxpopulation)})
                
                svg.selectAll('path')
                    .transition().duration(1500)
                    .attr('fill', function(d){return clrBinary(d.properties.continent)})
                    .attr('stroke', 'black');
            }
            
            svg.selectAll('path')
                    .data(geojson.features)
                    .enter().append('path')
                    .attr('d', path)
                    .attr('fill', 'white')
                    .attr('fill-opacity', 1)
                    .attr('stroke', 'white')
                    .attr('stroke-width', 1);
              
            svg.selectAll('circle')
                    .data(csv).enter()
                    .append('circle')
                    .attr('cx', function(d){return projection([d.longitude, d.latitude])[0]; })
                    .attr('cy', function(d){return projection([d.longitude, d.latitude])[1]; })
                    .attr('fill', function(d){return clr(d.Continent)})
                    .attr('fill-opacity', .5)
                    .attr('r', 0)
                    .attr('stroke', 'black');
            
            scrollFunctions = [continentxgeolocated,
                               countxgeolocated,  
                               countxpopulationxgeolocated,
                               countxcontinent, 
                               contxpopulationxcontinent,
                               countxpopulationxliteracy, 
                               countxpopulationxunemployment]
            
            gs = d3.graphScroll()
                .container(d3.select('#container'))
                .graph(d3.selectAll('#graph'))
                .sections(d3.selectAll('#sections > div'))
                .on('active', function(i){
                    var to_display = scrollFunctions;
                    to_display[i]()
                })
        }
        
        
        
    </script>
</body>