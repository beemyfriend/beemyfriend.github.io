unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
ggplot(vendimia_buin) +
geom_col(aes(use, bottles)) +
facet_wrap(~type)
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest()
vendimia_buin
vendimia_buin$data[1]
vendimia_buin <- data.frame(type, sold, tasting, n_price, v_price)
vendimia_buin <- vendimia_buin %>%
group_by(sold, tasting) %>%
nest() %>%
gather(use, bottles, -data) %>%
unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
ggplot(vendimia_buin) +
geom_col(aes(use, bottles)) +
facet_wrap(~type)
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn[1]
})) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn[1]
}))
vendimia_buin
vendimia_buin <- data.frame(type, sold, tasting, n_price, v_price)
vendimia_buin <- vendimia_buin %>%
group_by(sold, tasting) %>%
nest() %>%
gather(use, bottles, -data) %>%
unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn[1]
}) %>% unnest()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn[1]
}) %>% unnest())
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn[1]
}) %>% unnest()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn[1]
}) %>% unlist())
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn[1]
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn[1]
}) %>% unlist())
vendimia_buin
vendimia_buin$data[[1]]
vendimia_buin$data[[1]] %>% filter(use == 'tasting')
vendimia_buin$data[[1]] %>% filter(use == 'tasting') %>% .$cost_earn[1]
vendimia_buin$data[[1]] %>% filter(use == 'tasting') %>% .$cost_earn
vendimia_buin <- data.frame(type, sold, tasting, n_price, v_price)
vendimia_buin <- vendimia_buin %>%
group_by(sold, tasting) %>%
nest() %>%
gather(use, bottles, -data) %>%
unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn
}) %>% unlist())
vendimia_buin
vendimia_buin <- vendimia_buin %>% mutate(delta = earned - lost)
vendimia_buin
vendimia_buin <- vendimia_buin %>% mutate(delta = earned + lost)
vendimia_buin
vendimia_buin %>% group_by(lost, delta, type) %>%
vendimia_buin %>% group_by(lost, delta, type) %>% gather(earning_type, money, -type)
vendimia_buin %>% group_by(lost, delta, type) %>% gather(earning_type, money, -c(type, data))
vendimia_buin  %>% gather(earning_type, money, -c(type, data))
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes(earning_type, money)) + geom_col
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes(earning_type, money)) + geom_col()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes( money, fill = earning_type)) + geom_col()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes( money, fill = earning_type)) + geom_bar()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes( earning_type, money)) + geom_bar()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes( earning_type, money)) + geom_col()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes( earning_type, money)) + geom_col(position = 'stack')
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes(type, money)) + geom_col(position = 'stack')
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% ggplot(aes(type, money, fill = earning_type)) + geom_col()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% filter(earning_type != earned) %>% ggplot(aes(type, money, fill = earning_type)) + geom_col()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% filter(earning_type != 'earned') %>% ggplot(aes(type, money, fill = earning_type)) + geom_col()
vendimia_buin  %>% gather(earning_type, money, -c(type, data)) %>% filter(earning_type != 'earned') %>% mutate(lost = lost * -1) %>% ggplot(aes(type, money, fill = earning_type)) + geom_col()
vendimia_buin
ggplot(vendimia_buin) +
geom_col(aes(use, cost_earn)) +
facet_wrap(~type)
vendimia_buin <- data.frame(type, sold, tasting, n_price, v_price)
vendimia_buin <- vendimia_buin %>%
group_by(sold, tasting) %>%
nest() %>%
gather(use, bottles, -data) %>%
unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
ggplot(vendimia_buin) +
geom_col(aes(use, bottles)) +
facet_wrap(~type)
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(delta = earned + lost)
ggplot(vendimia_buin) +
geom_col(aes(use, cost_earn)) +
facet_wrap(~type)
vendimia_buin
vendimia_buin <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn
}) %>% unlist() * -1) %>%
mutate(delta = earned + lost) %>%
gather(earning_type, money, -c(type, data)) %>%
filter(earning_type != 'earned')
vendimia_buin <- vendimia_buin %>%
group_by(sold, tasting) %>%
nest() %>%
gather(use, bottles, -data) %>%
unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
vendimia_buin2 <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn
}) %>% unlist() * -1) %>%
mutate(delta = earned + lost) %>%
gather(earning_type, money, -c(type, data)) %>%
filter(earning_type != 'earned')
vendimia_buin <- data.frame(type, sold, tasting, n_price, v_price)
vendimia_buin <- vendimia_buin %>%
group_by(sold, tasting) %>%
nest() %>%
gather(use, bottles, -data) %>%
unnest() %>%
mutate(cost_earn = sapply(seq_along(use), function(i){
if(.$use[i] == 'sold'){
.$bottles[i] * .$v_price[i]
} else if (.$use[i] == 'tasting') {
.$bottles[i] * .$n_price[i] * -1
}
}))
vendimia_buin2 <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn
}) %>% unlist() * -1) %>%
mutate(delta = earned + lost) %>%
gather(earning_type, money, -c(type, data)) %>%
filter(earning_type != 'earned')
vendimia_buin2
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type))
vendimia_buin2 <- vendimia_buin %>%
group_by(type) %>%
nest() %>%
mutate(earned = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'sold') %>% .$cost_earn
}) %>% unlist()) %>%
mutate(lost = sapply(seq_along(data), function(i){
.$data[[i]] %>% filter(use == 'tasting') %>% .$cost_earn
}) %>% unlist() * -1) %>%
mutate(delta = earned - lost) %>%
gather(earning_type, money, -c(type, data)) %>%
filter(earning_type != 'earned')
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type)) +
scale_color_brewer(palette = c('brown, orange'))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type)) +
scale_color_brewer(palette = c('brown', 'orange'))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type), col = c('brown', orange))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type), col = c('brown', 'orange'))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type)) +
scale_fill_manual(c('brown', 'orange'))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type)) +
scale_fill_manual(values = c('brown', 'orange'))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type)) +
scale_fill_manual(values = c('#91bfdb', '#fc8d59'))
c('a', 'b', 'c') * 3
days <- c(rep('Friday', 3));
days
days <- c(rep('Friday', 3), rep('Saturday', 3), rep('Sunday', 3));
days
type <- rep(c('Cabernet Sauvignon', 'Sauvignon Blanc', 'Gasificado'), 3)
type
days <- rep(c('Friday', 'Saturday', 'Sunday'), 3)
days
type <- c(rep('Cabernet Sauvignon',3),rep('Sauvignon Blanc', 3), rep('Gasificado', 3))
type
vendimia_buin3 <- data.frame(type, days, bottles_sold, bottles_tasted)
bottles_sold <- c(25, 55, 27, 1, 7, 15, 4, 26, 9)
bottles_tasted <- c(12, 30, 16, 1, 5, 8, 2, 11, 11)
vendimia_buin3 <- data.frame(type, days, bottles_sold, bottles_tasted)
vendimia_buin3
gglot(vendimia_buin) +
geom_point(aes(bottles_tasted, bottles_sold))
ggplot(vendimia_buin) +
geom_point(aes(bottles_tasted, bottles_sold))
ggplot(vendimia_buin3) +
geom_point(aes(bottles_tasted, bottles_sold))
ggplot(vendimia_buin3) +
geom_smooth(aes(bottles_tasted, bottles_sold))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_smooth() +
geom_point()
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point() +
facet_wrap(~days)
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type)) +
facet_wrap(~days)
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type)) +
facet_wrap(~days) +
scale_fill_manual(values = c('#d95f02', '#7570b3', '#1b9e77'))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type), size = 5) +
facet_wrap(~days) +
scale_fill_manual(values = c('#d95f02', '#7570b3', '#1b9e77'))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type), size = 5) +
geom_smooth() +
facet_wrap(~days) +
scale_fill_manual(values = c('#d95f02', '#7570b3', '#1b9e77'))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_smooth() +
geom_point(aes(color = type), size = 5) +
facet_wrap(~days) +
scale_fill_manual(values = c('#d95f02', '#7570b3', '#1b9e77'))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_smooth() +
geom_point()
vendimia_buin3
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type), size = 5) +
facet_wrap(~days) +
scale_fill_manual(values = c('#d95f02', '#7570b3', '#1b9e77'))
ggplot(vendimia_buin2) +
geom_col(aes(type, money, fill = earning_type)) +
scale_fill_manual(values = c('#91bfdb', '#fc8d59'))
ggplot(vendimia_buin) +
geom_col(aes(use, bottles)) +
facet_wrap(~type)
vendimia_buin
vendimia_buin2
vendimia_buin2 %>% unnest()
vendimia_buin2 %>% unnest() %>% spread(use, cost_earn)
vendimia_buin2 %>% unnest()
vendimia_buin2 %>% unnest() %>% unite(bottles_cost_earn) %>%spread(use, cost_earn)
vendimia_buin2 %>% unnest() %>% unite(bottles_cost_earn)\
vendimia_buin2 %>% unnest() %>% unite(bottles_cost_earn)
vendimia_buin2 %>% unnest() %>% unite(bottles, cost_earn)
vendimia_buin2 %>% unnest() %>% unite(bottles_cost,bottles, cost_earn)
vendimia_buin2 %>% unnest() %>% unite(bottles_cost,bottles, cost_earn) %>% spread(use, bottles_cost)
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money)
?unite
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money) %>%
select(-lost) %>%
separate(sold)
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money) %>%
select(-lost) %>%
separate(sold, 'bottles_sold', 'money_gained')
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money) %>%
select(-lost) %>%
separate(sold, c('bottles_sold', 'money_gained'))
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money) %>%
select(-lost) %>%
separate(sold, c('bottles_sold', 'money_gained')) %>%
sperate(tasting, c('bottles_tasted', 'money_lost'))
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money) %>%
select(-lost) %>%
separate(sold, c('bottles_sold', 'money_gained')) %>%
separate(tasting, c('bottles_tasted', 'money_lost'))
vendimia_buin2 %>%
unnest() %>%
unite(bottles_cost,bottles, cost_earn) %>%
spread(use, bottles_cost) %>%
spread(earning_type, money) %>%
select(-lost) %>%
separate(sold, c('bottles_sold', 'money_gained')) %>%
separate(tasting, c('bottles_tasted', 'money_lost'))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type), size = 5) +
facet_wrap(~days) +
scale_fill_manual(values = c('#d95f02', '#1b9e77','#7570b3' ))
ggplot(vendimia_buin3, aes(bottles_tasted, bottles_sold)) +
geom_point(aes(color = type), size = 5) +
facet_wrap(~days) +
scale_color_manual(values = c('#d95f02', '#7570b3', '#1b9e77'))
price_check <- data.frame(num_bottles)
num_bottles <- c(1:300)
price_check <- data.frame(num_bottles)
price_check
price_check <- data.frame(num_bottles) %>%
mutate(normal_price = num_bottles * 2.5) %>%
mutate(vendimia_price = num_bottles * 3.5)
price_check
ggplot(price_check) +
geom_line(aes(normal_price))
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price))
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price)) +
geom_line(aes(num_bottles, vendimia_price))
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02') +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77')
ggplot(price_check, size = 3) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02') +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77')
ggplot(price_check, width =3) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02') +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77')
ggplot(price_check, width = 6) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02') +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77')
ggplot(price_check, size = 6) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02') +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77')
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02', size = 5) +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77')
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02', size = 3) +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77', size = 3)
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02', size = 2) +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77', size = 2)
price_check
?geom_vline
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02', size = 2) +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77', size = 2) +
geom_vline(xintercept = 100)
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02', size = 2) +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77', size = 2) +
geom_vline(xintercept = 100, ylim(100, 400))
ggplot(price_check) +
geom_line(aes(num_bottles, normal_price), color = '#d95f02', size = 2) +
geom_line(aes(num_bottles, vendimia_price), color = '#1b9e77', size = 2) +
geom_vline(xintercept = 100) +
geom_vline(xintercept = 200)
price_check <- data.frame(num_bottles) %>%
mutate(normal_price = num_bottles * 2.5) %>%
mutate(vendimia_price = num_bottles * 3.5) %>%
mutate(delta = vendimia_price - num_bottles)
price_check[100]
price_check[,100]
price_check[100,]
price_check <- data.frame(num_bottles) %>%
mutate(normal_price = num_bottles * 2.5) %>%
mutate(vendimia_price = num_bottles * 3.5) %>%
mutate(delta = vendimia_price - normal_price) %>%
mutate(delta_normal_bottles = delta/2.5)
price_check[100,]
price_check[200,]
vendimia_buin2
vendimia_buin
100/2.500
vendimia_buin %>% filter(use == 'tasting) %>% .$cost_earn %>% sum()
vendimia_buin %>% filter(use == 'tasting) %>% .$cost_earn %>% sum()
vendimia_buin %>% filter(use == 'tasting') %>% .$cost_earn %>% sum()
vendimia_buin %>% filter(use == 'tasting') %>% .$cost_earn %>% sum() * -1
vendimia_buin3
knitr::opts_chunk$set(echo = TRUE)
vendimia_buin3 %>% knitr::kable()
5 + 5
data.frame(c(1,2,3), c('a', 'b', 'c'))
setwd('D://Websites/beemyfriend.github.io/Projects/')
attach(haven)
library(haven)
library(readr)
read_tsv()
read_tsv('TIMSS_2015_NO_BM.tsv') -> timss_2015
timss_2015
timss_2015$correct_ratio_per_question
library(tidyverse)
timss_2015$correct_ratio_per_question_range <- sapply(timss_2015$correct_ratio_per_question,
function(x){
if(x <= .1){
'0-10'
} else if (x <= .2){
'11-20'
} else if (x <= .3){
'21-30'
} else if (x <= .4){
'31-40'
} else if (x <= .5){
'41-50'
} else if (x <= .6){
'51-60'
} else if (x <= .7){
'61-70'
} else if (x <= .8){
'71-80'
} else if (x <= .9){
'81-90'
} else {
'91-100'
}
})
timss_2015$correct_ratio_per_question_range
write_tsv(timss_2015 ,'TIMSS_2015_NO_BM.tsv')
timss_2015$correct_ratio_per_question_range %>% as.factor() %>% levels()
