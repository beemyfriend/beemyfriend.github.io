<head>
    <link rel='stylesheet' href='../styles.css'> 
    <style>
        #sections > div{
            opacity: .3;
        }
        
        #sections div.graph-scroll-active{
            opacity: 1;
        }
        
        #container{
            position: relative;
            overflow: auto;
        }
        
        #sections{
            width: 400px;
            float: left;
        }
        
        #graph{
            width: 500px;
            height: 500px;
            float: left;
            margin-left: 40px;
        }
        
        #graph.graph-scroll-fixed{
            position: fixed;
            top: 0px;
            margin-left: 440;
        }
        body{
            background-color: whitesmoke;
        }
        svg{
            background-color: none;
            position: absolute;
            top:0px;
            left: 0px;
            z-index: 2;
        }
        path.line{
            fill:none;
            stroke: lightgrey;
            stroke-width: 1px;
        }
        .annotation path{
            stroke-width: 5;
            fill: none;
        }
        
        .black.annotation path{
            stroke: black;
            stroke-opacity: .5;
        }
        
        .pink.annotation path{
            stroke: #E8336D;
            stroke-opacity: .5;
        }
        
        .blue.annotation path{
            stroke: blue;
            stroke-opacity: .5;
        }
        .annotation path.connector-arrow,
        .title text, .annotation text,
        .annotation.callout.circle .annotation-subject path{
            fill: #E8336D;
            font-size: 13;
        }
        .annotation-note-bg{
            fill: rgba(255, 255, 255, 0);
        }
        .annotation-note-title{
            font-weight: bold;
        }
        .annotation.xythreshold{
            cursor: move;
        }
        .hidden{
            display: none;
        }
        text.hover{
            font-size: .7em;
        }
        text.title{
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div id = 'header'>
        <ul>
            <li><a href = '../index.html'>Home</a></li>
            <li><a href = '../Articles/articles.html'>Articles</a></li>
            <li><a href = 'projects.html'>Projects</a></li>
        </ul>
    </div>
    <div id = 'content'>
        <div id = 'container'>
            <div id = 'sections'>
                <div>
                    <h3>Introduction to Fractals</h3>
                    <p>A fractal is a geometric figure, each part of which has the same statistical character as the whole. If the replication is exactly the same at every scale, it is called a self-similar pattern. The Sierpinski Gasket, shown on the right of this page, is an example of a self-similar fractal.</p>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>Notice how the overall figure is made up of three identical figures that are half the width and height of the overall figure.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br>
                </div>
                <div>
                    <p>Alternatively, it can be said that the overall figure is made up of nine identical figures that are a fourth the width and height of the overall figure. Or even 27 identical figures that are an eigth the width and height of the overall figure  </p>
                    <br><br><br><br><br><br><br>
                    <br><br><br>
                </div>
                <div>
                    <p>We can keep on saying that the figure is made of many more and much smaller identical figures, but it is more practical to say that the fractal is made with the the least and larger iterations. Which in this case is just three identical figures at half the width and height.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br></div>
                <div>
                    <h3>Building a Fractal</h3>
                    <p>To build a self-similar fractal, we need to start with an image. In this tutorial we will use a square. In general, it does not matter what image you start with. We then manipulate the image by giving it commands. We can give the image 5 different commands.</p>
                    <p>Please note that in the mini-tutorial below, we will use the full cartesian coordinate system, that is, we will use both a positive and negative x-axis as well as both a positive and negative y-axis. However, normally when making fractals we will only use the positive cartesian coordinate system, that is we will only use the positive x-axis and the positive y-axis. Anything outside of the positive cartesian coordinate system will not be seen.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br>
                </div>
                <div>
                    <p><b>1a: </b>We can scale down the width of the image on the x-axis. Here we show an example of the image's width being scaled down by 0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>1b: </b>If we scale the image's width by a negative number, then the image's width is scaled down <b>AND</b> flipped on the y-axis. That is, the new image is a reflection of the original image. Here is an example of the image's width being scaled down by -0.5, that is, the width is scaled-down to half again, but the image is now reflected on the y-axis.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>2a: </b>We can scale down the height of the image on the y-axis. Here we show an example of the image's height being scaled down by 0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>2b: </b>If we scale the image's height by a negative number, then the image's height is scaled down  <b>AND</b> flipped on the x-axis. That is, the new image is a reflection of the original image. Here is an example of the image's height being scaled down by -0.5, that is, the height is scaled-down to half again, but the image is now reflected on the x-axis.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>3: </b>We can rotate the image counter-clockwise. Rotation always happens on (0,0) axis and are measured in degrees. Here we rotate the image by 45 degrees.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>4a: </b>We can move the image to a coordinate on the x-axis. Horizontal movement always starts on x = 0, so it does not matter if the image was flipped or rotated. Here we move the image, scaled-down by half, to the right by 0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>4b: </b> Here we again scale down the image by half, but this time we scale down the image's width by -.5. We then move the scaled-down image to the right by 0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>5a: </b>We can move the image to a coordinate on the y-axis. Vertical movement always starts on y = 0, so it does not matter if the image was flipped or rotated. Here we move the image, scaled-down by half, upwards by 0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p><b>5b: </b>Here we again scale down the image by half, but this time we scale down the image's height by -.5. We then move the scaled-down image upwards by 0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The commands are given to the image in the same order that they were presented. First we scale-down the image, then we rotate the image, and then we move the image to new (x,y) coordinates.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <h3>Example #1</h3>
                    <p>The Sierpinski gasket that we showed earlier is created by giving an original image three different sets of commands.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The first set of rules are:</p>
                    <p><b>Scale-Width: </b>0.5</p>
                    <p><b>Scale-Height: </b>0.5</p>
                    <p><b>Rotation Angle: </b> 0 degrees</p>
                    <p><b>X-Coordinate: </b>0.0</p>
                    <p><b>Y-Coordinate: </b>0.0</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The second set of rules are:</p>
                    <p><b>Scale-Width: </b>0.5</p>
                    <p><b>Scale-Height: </b>0.5</p>
                    <p><b>Rotation Angle: </b> 0 degrees</p>
                    <p><b>X-Coordinate: </b>0.5</p>
                    <p><b>Y-Coordinate: </b>0.0</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>                
                <div>
                    <p>The third and final set of rules are:</p>
                    <p><b>Scale-Width: </b>0.5</p>
                    <p><b>Scale-Height: </b>0.5</p>
                    <p><b>Rotation Angle: </b> 0 degrees</p>
                    <p><b>X-Coordinate: </b>0.0</p>
                    <p><b>Y-Coordinate: </b>0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>We then iterate this pattern 10 times to see the outcome</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The Sierpinski Gasket shows that we don't need a particularly complex algorithm to make a beautiful fractal. In fact, the algorithm needed to make the Sierpinski Gasket only uses three rules</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <h3>Example #2</h3>
                    <p>It turns out we make a large number of fractals with just three rules. Try to figure out how to make this fractal before looking at the rules.</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The first set of rules are:</p>
                    <p><b>Scale-Width: </b>-0.5</p>
                    <p><b>Scale-Height: </b>0.5</p>
                    <p><b>Rotation Angle: </b> 90 degrees</p>
                    <p><b>X-Coordinate: </b>0.5</p>
                    <p><b>Y-Coordinate: </b>0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The second set of rules are:</p>
                    <p><b>Scale-Width: </b>0.5</p>
                    <p><b>Scale-Height: </b>0.5</p>
                    <p><b>Rotation Angle: </b> -90 (or 270) degrees</p>
                    <p><b>X-Coordinate: </b>0.5</p>
                    <p><b>Y-Coordinate: </b>0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>The third and final set of rules are:</p>
                    <p><b>Scale-Width: </b>0.5</p>
                    <p><b>Scale-Height: </b>0.5</p>
                    <p><b>Rotation Angle: </b> 0 degrees</p>
                    <p><b>X-Coordinate: </b>0.0</p>
                    <p><b>Y-Coordinate: </b>0.5</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>We then iterate this pattern 10 times to see the outcome</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                    <p>Now try to make a few of your own. Try to replicate the below example. If you want to learn more about fractals, then please visit <a href = 'http://users.math.yale.edu/public_html/People/frame/Fractals/'>Michael Frame's website</a>. He was the amazing person who introduced me to fractals. If you want an even more in depth look into fractals, then check out his book (co-written by Amelia Urry) <a href = 'http://yalebooks.com/book/9780300197877/fractal-worlds'>"Fractal Worlds</a>"</p>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
                <div>
                     <form name = 'createRule' >
                        <br>
                        <br>
                        <h3>Create Fractal Rules</h3>
                        <p>Now try to create your own:</p>
                        <label id = 'xslabel'>X-Scale: 0.5</label>
                        <input id = 'xscale' type = 'number' min = '-1' max = '1' step = '.05' value = '.5' onchange="document.getElementById('xslabel').innerHTML = 'X-Scale: ' + this.value;"/>
                        <br>
                        <label id = 'yslabel'>Y-Scale: 0.5</label>
                        <input id = 'yscale' type = 'number' min = '-1' max = '1' step = '.05' value = '.5' onchange="document.getElementById('yslabel').innerHTML = 'Y-Scale: ' + this.value;"/>
                        <br>
                        <label id = 'anglelabel'>Angle: 0 degrees</label> 
                        <input id = 'angle' type = 'number' min = 0 max = '360' step = '5' value = '0' onchange="document.getElementById('anglelabel').innerHTML = 'Angle: ' + this.value + ' degrees';"/>
                        <br>
                        <label id = 'xclabel'>X-Coordinate: 0</label>
                        <input id = 'x' type = 'number' min = '-1' max = '1' step = '.05' value = '0' onchange="document.getElementById('xclabel').innerHTML = 'X-Coordinate: ' + this.value;"/>
                        <br>
                        <label id = 'yclabel'>Y-Coordinate: 0</label>
                        <input id = 'y' type= 'number' min = '-1' max = '1' step = '.05' value = '0' onchange="document.getElementById('yclabel').innerHTML = 'Y-Coordinate: ' + this.value;"/>
                        <br><br>
                        <button onclick = 'createNewRule(); update(); return false;'>Add Rule</button>
                        <br>
                        <button onclick="drawFractal(myRules, 10, 1000, false, graph_canvas, graph_context); return false;">Build the Fractal!</button>
                    </form>
                    <div id = 'showrules'></div>
                    <br><br><br><br><br><br><br>
                    <br><br><br><br><br><br><br>
                </div>
            </div>
            <div id = 'graph'><canvas id = 'graph_canvas' width = '500' height = '500'></canvas></div>
        </div>
        
        
        <div style = 'position: absolute; top:0px; left:-500px'><canvas id = 'myCanvas' width = '500' height = '500' ></canvas></div>
        <div style = 'position: absolute; top:500px; left:-500px'><canvas id = 'otherCanvas' width = '500' height = '500'></canvas></div>

    </div>
    
    <script src = 'd3.js'></script>
    <script src ='d3v4+jetpack.js'></script>
    <script src = 'graph-scroll.js'></script>
    <script src = 'd3-annotation.js'></script>
    <script>
        d3.graphScroll()
            .sections(d3.selectAll('#sections > div'))
            .on('active', function(i){console.log(i + 'th section active');});
    
        d3.graphScroll()
            .graph(d3.selectAll('#graph'))
            .container(d3.select('#container'));
        
        var graph_canvas = document.getElementById('graph_canvas'),
            graph_context = graph_canvas.getContext('2d');
        
        var colors = ['orange', 'purple', 'steelblue', 'black'];
        var sierpinski_rules = [[.5, .5, 0, 0, 0], [.5, .5, 0, .5, 0], [.5, .5, 0, 0, .5]];
        var complex_rules = [[-.5, .5, 90, .5, .5], [.5, .5, -90, .5, .5], [.5, .5, 0, 0, .5]];
        var alt_rules = [[[.5, .5, 0, 0, 0], [.5, .5, 0, .5, 0], [.5, .5, 0, .25, .5]], [[-.5, .5, 0, .5, 0], [.5, .5, 0, 0, .5], [.5, .5, 0, .5, .5]], [[.5, .5, 0, 0, 0], [.5, .5, 0, .5, 0], [.5, -.5, 0, .5, 1]], [[-.25, .25, 0, .25, 0], [-.25, .25, 0, 1, 0], [.5, .5, 0, .25, .25], [-.25, .25, 0, 1, .5], [-.25, .25, 0, .25, .75], [.25, .25, 0, .5, .75]], [[-.5, .5, 90, .5, .5], [.5, .5, 90, 1, 0], [-.5, .5, -90, 0, .5]]];
        
        var gs = d3.graphScroll()
            .container(d3.select('#container'))
            .graph(d3.selectAll('#graph'))
            .sections(d3.selectAll('#sections > div'))
            .on('active', function(i){
                var to_display = [function(){if(animate){animate.stop()};
                                             drawFractal(sierpinski_rules, 10, 0, false, otherCanvas, otherCtx)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(sierpinski_rules, 10, 0, false, otherCanvas, otherCtx, 1)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(sierpinski_rules, 10, 0, false, otherCanvas, otherCtx, 2)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(sierpinski_rules, 10, 0, false, otherCanvas, otherCtx, 3)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.4, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.3, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.25, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}], 
                                                  500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.4, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.3, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.25, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[-.25, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}], 
                                                  500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .4, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.5, .3, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.5, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},], 
                                                  500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .4, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.5, .3, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.5, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.5, -.25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}], 
                                                  500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.5, .5, 10, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 20, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 30, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 45, .5, .5]], 2, 0, 'angle', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.33, .33, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .6, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .75, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.33, .33, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[-.25, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[-.25, .25, 0, .6, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[-.25, .25, 0, .75, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.33, .33, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .5, .6]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .5, .75]], 2, 0, 'quad', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){draw([function(){drawFractal([[.5, .5, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.33, .33, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, .25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.25, -.25, 0, .5, .5]], 2, 0, 'quad', otherCanvas, otherCtx)},
                                                   function(){drawFractal([[.25, -.25, 0, .5, .6]], 2, 0, 'quad', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.25, -.25, 0, .5, .75]], 2, 0, 'quad', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){if(animate){animate.stop()}; 
                                             drawFractal(sierpinski_rules, 10, 0, 'single', otherCanvas, otherCtx)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(sierpinski_rules, 10, 0, 'single', otherCanvas, otherCtx)},
                                  function(){draw([function(){drawFractal([[1, 1, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.75, .75, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){draw([function(){drawFractal([[1, 1, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.75, .75, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, .25, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, .5, 0]], 2, 0, 'single', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){draw([function(){drawFractal([[1, 1, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.75, .75, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, .25]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, .5]], 2, 0, 'single', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(sierpinski_rules, 10, 500, 'single', graph_canvas, graph_context);},
                                  function(){if(animate){animate.stop()}; 
                                             drawFractal(sierpinski_rules, 10, 0, false, graph_canvas, graph_context)},
                                  function(){if(animate){animate.stop()}; 
                                             drawFractal(complex_rules, 10, 0, false, graph_canvas, graph_context)},
                                  function(){draw([function(){drawFractal([[1, 1, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.75, .75, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[-.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[-.5, .5, 90, .25, .25]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[-.5, .5, 90, .5, .5]], 2, 0, 'single', otherCanvas, otherCtx)}],
                                                 500)},                                  
                                  function(){draw([function(){drawFractal([[1, 1, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.75, .75, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, -45, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, -90, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, -90, .25, .25]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, -90, .5, .5]], 2, 0, 'single', otherCanvas, otherCtx)}],
                                                 500)}, 
                                  function(){draw([function(){drawFractal([[1, 1, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.75, .75, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, 0]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, .25]], 2, 0, 'single', otherCanvas, otherCtx)}, 
                                                   function(){drawFractal([[.5, .5, 0, 0, .5]], 2, 0, 'single', otherCanvas, otherCtx)}],
                                                 500)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(complex_rules, 10, 500, false, graph_canvas, graph_context)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(complex_rules, 10, 0, false, graph_canvas, graph_context)},
                                  function(){if(animate){animate.stop()};
                                             drawFractal(alt_rules[Math.floor(Math.random()*alt_rules.length)], 7, 500, false, graph_canvas, graph_context)}
                                 ];
                
                graph_context.clearRect(0, 0, 500, 500);
                to_display[i]()
                if(i < 19){
                    graph_context
                        .drawImage(otherCanvas, 0, 0)
                }
            });
        
        var myCanvas = document.getElementById('myCanvas'),
            myCtx = myCanvas.getContext('2d'),
            otherCtx = document.getElementById('otherCanvas').getContext('2d'),
            height = myCanvas.height,
            width = myCanvas.width,
            myRules = [];

        var showRules = d3.select('#showrules');
        
        function update(){
            var text = showRules.selectAll('p')
                .data(myRules);
                        
            text.enter().append('p')
                .merge(text)
                .attr('id', function(d,i){return 'rule'+(i+1);})
                .html(function(d, i){return '<b>Fractal Rule #' + (i+1) +'</b><br><b>X-Scale:</b> ' + d[0] + ' <b>Y-Scale:</b> ' + d[1] + ' <b>Angle:</b> ' + d[2] + ' <b>X-Coordinate:</b> ' + d[3] + ' <b>Y-Coordinate:</b> ' + d[4];});
            
            text.exit().remove();
            
            var buttons = showRules.selectAll('input')
                .data(myRules);
            
            function handleClick(i){
                myRules.splice(i, 1);
                update();
            };
            
            buttons.enter().append('input')
                .attr('type', 'button')
                .attr('value', function(d, i){return 'delete rule '+ (i+1)})
                .on('click', function(d,i){return handleClick(i)})
            
            buttons.exit().remove();
        }
        
        function createNewRule(){
            var xscale = document.getElementById('xscale').value;
            var yscale = document.getElementById('yscale').value;
            var angle = document.getElementById('angle').value;
            var x = document.getElementById('x').value;
            var y = document.getElementById('y').value;
            myRules[myRules.length] = [xscale, yscale, angle, x, y];
        }
        
        function init(){
            myCtx.fillStyle = 'purple';
            myCtx.fillRect(0, 0, width, height);
            myCtx.fillStyle = 'yellow';
            myCtx.fillRect(0, 0, width/10 , height/10 );
            myCtx.fillStyle = 'pink';
            myCtx.fillRect(width * 9 / 10, height * 9 / 10, width/10, height/10);
            myCtx.fillStyle = 'blue';
            myCtx.fillRect(0, height * 9 /10, width/10, height/10);
            myCtx.fillStyle = 'brown';
            myCtx.fillRect(width * 9 / 10, 0, width/10, height/10);
            myCtx.save()
            myCtx.beginPath();
            myCtx.lineWidth = 10;
            myCtx.strokeStyle = 'white';
            myCtx.arc(width/2, height/2, width/2 - 10, 0, Math.PI);
            myCtx.moveTo(width/2 - 10, height/4);
            myCtx.arc(width/4, height/4, width/4 - 10, 0, 2*Math.PI);
            myCtx.moveTo(width/2 + 10, height/4);
            myCtx.lineTo(width-10, height/4)
            myCtx.stroke();
            myCtx.restore();
            myCtx.strokeStyle = 'red';
            myCtx.rect(0, 0, width, height);
            myCtx.stroke();   
       }        
        
        function toRads(degree){
            return Math.PI / 180 * degree;
        }

        function fractalRules(scale_x, scale_y, angle, x, y, select_context){
            if(scale_x > 0){
                angle = -angle
            }
            angle = toRads(angle);
            var dw = width/scale_x;
            var dh = height/scale_y;
            var dx = (dw * x)
            var dy = dh - (dh * y) - (dh * scale_y);
            select_context.save();
            select_context.scale(scale_x, scale_y);
            select_context.translate(0, height)
            select_context.translate(dx, dy)
            select_context.rotate(angle);
            select_context.drawImage(myCanvas, 0, -height);
            select_context.restore();
        }
        
        var animateFractal;
        
        //draws the fractals, if time_per_iterations == 0, then the function provides a picture, if time_per_iteration > 0, then the 
        //function provides an animation that displays the creation of the fractal
        function drawFractal(rules, iterations, time_per_iteration, axisType, select_canvas, select_context, annot_code){
            if(animateFractal){animateFractal.stop()};
            
            var nowFractal = 0;
            
            function start(){
                    init();
                    select_context.drawImage(myCanvas, 0, 0);
                    nowFractal++
                }

            if(time_per_iteration > 0){
                animateFractal = d3.interval(function(){nowFractal < 1 ? start() : updateFractal()}, time_per_iteration);
                                
                function updateFractal(){
                    if(nowFractal >= iterations){
                        animateFractal.stop();
                    } else {
                        select_context.clearRect(0, 0, width, height)
                        for(var i = 0; i < rules.length; i++){
                            fractalRules(Number(rules[i][0]), Number(rules[i][1]), Number(rules[i][2]), Number(rules[i][3]), Number(rules[i][4]), select_context)
                        }
                        myCtx.clearRect(0, 0, width, height);
                        myCtx.drawImage(select_canvas, 0, 0);
                        nowFractal++;
                    }
                }
            } else {
                function updateFractal(){
                    select_context.clearRect(0, 0, width, height)
                    if(nowFractal <1){
                        start()
                    } else {
                        for(var i = 0; i < rules.length; i++){
                            fractalRules(Number(rules[i][0]), Number(rules[i][1]), Number(rules[i][2]), Number(rules[i][3]), Number(rules[i][4]),
                            select_context)
                        }
                        myCtx.clearRect(0, 0, width, height);
                        myCtx.drawImage(select_canvas, 0, 0);
                        nowFractal++;
                    }
                }
                while(nowFractal < iterations-1){
                    updateFractal()
                }
                
                updateFractal()
                
                axisScale(axisType)

            }
            create_annot_rect(annot_code)
        }
        
        var framestest;
        var animate;
        //frames is an array of images and frame_rate is speed at which we show those images
        function draw(frames, frame_rate){
            if(animate){animate.stop()};

            animate = d3.interval(function(){update()}, frame_rate);
            
            var now = 0;
            framestest = frames
            function update(){
                if(now >= frames.length){
                    animate.stop()
                } else {
                    console.log(now);
                    graph_context.clearRect(0, 0, 500, 500);
                    frames[now]();                    
                    graph_context.drawImage(myCanvas, 0, 0);
                    now++
                }
            }
        }

        var svg = d3.select('#graph')
            .append('svg')
            .attrs({width:500, height: 500});
        
        function create_annot_rect(annot_code){
            svg.selectAll('.annotation-group')
                .remove()

            function annot_rect(x,y,width,height, classColor, labelInfo){
                var annot_obj = {
                    x: x,
                    y: y,
                    subject: {
                        width: width,
                        height: height
                    },
                    type: d3.annotationCalloutRect,
                    className: classColor
                }
                
               if(labelInfo){
                    annot_obj.note = {
                        label: labelInfo[0]
                    };
                    annot_obj.dx = labelInfo[1];
                    annot_obj.dy = labelInfo[2];
                    
                }
                return annot_obj
            }
            
            var annot;
            if (annot_code == 1){
                annot = [annot_rect(250, 250, -250, 250, 'blue', ['Another identical image', 100, -110]), annot_rect(250, 0, -250, 250, 'pink', ['An identical image at 1/2 scale', 100, 50]), annot_rect(250, 250, 250, 250, 'black', ['Yet another identical image',  100, -50])];
            } else if (annot_code == 2){
                annot = [annot_rect(0, 0, 125, 125, 'pink'), annot_rect(0, 125, 125, 125, 'pink', ['Each identical image has it\'s own scaled-down identical images', 150, -25]), annot_rect(125, 125, 125, 125, 'pink'), annot_rect(0, 250, 125, 125, 'blue'), annot_rect(0, 375, 125, 125, 'blue'), annot_rect(125, 375, 125, 125, 'blue'), annot_rect(250, 250, 125, 125, 'black'), annot_rect(250, 375, 125, 125, 'black'), annot_rect(375, 375, 125, 125, 'black')];
            } else if (annot_code == 3){
                annot = [annot_rect(250, 250, -250, 250, 'blue', ['This image contains 81 identical images at 1/16 scale', 60, -115]), annot_rect(250, 0, -250, 250, 'pink', ['This image contains 27 identical images at 1/8 scale', 100, 25]), annot_rect(250, 250, 250, 250, 'black', ['This image is the same as the other two, but only has 3 images at 1/2 scale',  80, -20])]
            } else {
                annot = [];
            }

            var makeAnnotations = d3.annotation()
                .annotations(annot)

            svg.append('g')
                .attr('class', 'annotation-group')
                .call(makeAnnotations);
        }
        
        function axisScale(type){
            svg.selectAll('.fractalAxis')
                .remove();
            
            if(type == 'quad'){
                svg.append('path.fractalAxis')
                    .attrs({d: 'M 0 250 h 125 v 5 v -10 v 5 h 125 v 125 h 5 h -10 h 5 v 125 v -375 h 5 h -10 h 5 v -125 v 250 h 125 v 5 v -10 v 5 h 125', fill: 'transparent', 'stroke-width': 2, stroke: 'black'})
                
                svg.append('path.fractalAxis')
                        .attrs({d: 'M 250 0 v 250 h 250 v 250 h -500 v -500 h 250', 'fill-opacity': .4, fill: 'black'})
                
                svg.selectAll('text.fratalAxis')
                    .data([[245, 265, '(0,0)', 'end'], [375, 265, '0.5', 'middle'], [125, 265, '-0.5', 'middle'], [245, 125, '0.5', 'end'], [245, 375, '-0.5', 'end']])
                    .enter().append('text.fractalAxis')
                    .attrs({transform: function(d){return 'translate(' + d[0] + ',' + d[1] + ')'}, fill: 'black', 'font-size': 15, 'text-anchor': function(d){return d[3]}})
                    .text(function(d){return d[2]});

            } else if (type == 'single') {
                svg.append('path.fractalAxis')
                    .attrs({d: 'M 0 0 v 250 h 10 h -10 v 250 h 250 v -10 v 10 h 250', fill: 'transparent', 'stroke-width': 5, stroke: 'black'});
                
            } else if (type == 'angle') {
                svg.append('path.fractalAxis')
                    .attrs({d: 'M 0 250 h 125 v 5 v -10 v 5 h 125 v 125 h 5 h -10 h 5 v 125 v -375 h 5 h -10 h 5 v -125 v 250 h 125 v 5 v -10 v 5 h 125', fill: 'transparent', 'stroke-width': 2, stroke: 'black'})
                
                svg.append('path.fractalAxis')
                        .attrs({d: 'M 250 0 v 250 h 250 v 250 h -500 v -500 h 250', 'fill-opacity': .4, fill: 'black'})
                
                svg.selectAll('text.fratalAxis')
                    .data([[245, 265, '(0,0)', 'end'], [375, 265, '0.5', 'middle'], [125, 265, '-0.5', 'middle'], [245, 125, '0.5', 'end'], [245, 375, '-0.5', 'end'], [370, 200, '45 degrees', 'start']])
                    .enter().append('text.fractalAxis')
                    .attrs({transform: function(d){return 'translate(' + d[0] + ',' + d[1] + ')'}, fill: 'black', 'font-size': 15, 'text-anchor': function(d){return d[3]}})
                    .text(function(d){return d[2]}); 
                
                svg.append('path.fractalAxis')
                    .attrs({d: 'M 375 250 A 375 250 0 0 0 345 155', fill: 'transparent', stroke: 'purple', 'stroke-width': 5})
            }  
        }
                
    </script>
</body>