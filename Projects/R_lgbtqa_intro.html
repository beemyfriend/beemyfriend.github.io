<head>
    <style>
        #sections > div{
            opacity: .3;
        }
        
        #sections div.graph-scroll-active{
            opacity: 1;
        }
        
        #container{
            position: relative;
            overflow: auto;
        }
        
        #sections{
            width: 300;
            float: left;
        }
        
        #graph{
            float: left;
            left: 0px;
        }
        
        #graph.graph-scroll-fixed{
            position: fixed;
            top: 0px;
            left: 300;
            margin-left: 10;
        }
        body{
            background-color: whitesmoke;
        }
        svg{
            background-color: none;
            position: absolute;
            top:0px;
            z-index: 2;
        }

    </style>
</head>
<body>
    <div id = 'container'>
        <div id = 'sections'>
            <div>
                <b>Everyone is a current or an aspiring useR!</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
            <div>
                <b>While it is not necessarily obvious, the useRs can be split into gender groups</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
            <div>
                <b>Home country is another important combo</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
            <div>
                <b>Even if these groups split up...</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
            <div>
                <b>They can be comforted by the fact that they can always find eachother</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
            <div>
                <b>It's not so obvious for those within the LGBTQ community</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
            <div>
                <b>There is always a chance that one member of the LGBTQ might expose him or herself to another member of the community</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>            
            <div>
                <b>But this depends on the one member being confident in exposing him or herself and the other person finding that member within a crowd.</b>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br><br><br>
                <br><br><br><br><br><br>
            </div>
        </div>
        <div id = 'graph'></div>
    </div>
</body>
<script src = 'd3v4+jetpack.js'></script>
<script src = 'graph-scroll.js'></script>
<script>
    var width = 1100,
        height = 600,
        info_width = 300,
        animation_width = width - info_width;
    
    var margin = {
        top: 20, 
        left: 20,
        bottom: 20, 
        right: 20
    };
    
    var svg = d3.select('#graph')
        .append('svg')
        .at({width: animation_width, height: height});
    
    var rows = d3.scaleLinear()
        .domain([0, 12])
        .range([margin.top, height - margin.bottom]);
    
    var columns = d3.scaleLinear()
        .domain([0, 14])
        .range([margin.left, animation_width - margin.right]);
    
    var color_gender = d3.scaleOrdinal()
        .domain(['Male', 'Female', 'Other/Unknown'])
        .range(['blue', 'red', 'brown']);
    
    var color_country = d3.scaleOrdinal()
        .domain(['USA', 'New Zealand', 'United Kingdom', 'Ireland', 'Germany', 'Other'])
        .range(['red', 'blue', 'green', 'orange', 'purple', 'grey']);
    
    var opacity_lgbtq = d3.scaleOrdinal()
        .domain(['lgbtq', 'not_lgbtq'])
        .range([1, .1])
    
    var rect_width = columns(1) - columns(0),
        rect_height = rows(1) - rows(0);
    
    d3.tsv('R_lgbtqa_intro.tsv', function(err, tsv){
        data = tsv;
        
        var useRs = svg.appendMany(tsv, 'rect')
            .at({y: function(d){return rows(+d.point_row)}, x: function(d){return columns(+d.point_column)}, width: rect_width, height: rect_height, id: function(d){return 'id'+d.id}})
            .st({fill: 'grey', stroke: 'white'});
        
        function gender_groups(){
            useRs.transition()
                .duration(1000)
                .at({x: function(d){return columns(+d.gender_column)}})
                .st({fill: function(d){return color_gender(d.gender)}})
        }
        
        function user_group(){
            useRs.transition()
                .duration(1000)
                .at({y: function(d){return rows(+d.point_row)}, x: function(d){return columns(+d.point_column)}})
                .st({fill: 'grey', stroke: 'white', 'fill-opacity': 1});
        }
        
        function country_groups(){
            user_group();
            useRs.transition()
                .delay(1000)
                .duration(1000)
                .at({y: function(d){return rows(+d.country_row)}, x: function(d){return columns(+d.country_column)}})
                .st({fill: function(d){return color_country(d.country)}});
        }
        
        function mixed_country(){
            useRs.transition()
                .duration(1000)
                .at({y: function(d){return rows(+d.mixed_row)}, x: function(d){return columns(+d.mixed_column)}})
                .st({fill: function(d){return color_country(d.country)}, 'fill-opacity': 1});
        }
        
        function mixed_gender(){
            useRs.transition()
                .duration(1000)
                .st({fill: function(d){return color_gender(d.gender)}, 'fill-opacity': 1});
        }
        
        function lgbtq(){
            useRs.transition()
                .duration(1000)
                .at({y: function(d){return rows(+d.mixed_row)}, x: function(d){return columns(+d.mixed_column)}})
                .st({'fill-opacity': function(d){return opacity_lgbtq(d.conversation)}});
        }
        
        function conversation(){
            useRs.transition()
                .delay(1000)
                .duration(1000)
                .at({y: function(d){return rows(+d.point_row)}, x: function(d){return columns(+d.point_column)}});
        }
        
        animations = [gender_groups, country_groups, mixed_country, mixed_gender, lgbtq, conversation]
            
    })
    
</script>