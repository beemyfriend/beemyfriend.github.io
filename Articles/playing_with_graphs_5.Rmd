---
title: 'Playing With Graphs 5: Surveys'
author: "beemyfriend"
date: "January 20, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages <- c('tidyverse', 'stringr', 'igraph', 'diagram', 'tinkR')
sapply(packages, library, character.only = T)
g <- read_graph("../Data/data_vis_survey.graphml", 'graphml')
```

## Introduction

Today we're going to explore survey data as if it were a graph. This exploration was inspired by a talk that [**Ed Finkler** provided at Nodevember 2016](https://www.youtube.com/watch?v=GekQqFZm7mA). The schema uses the following logic: There are **People**, there are **Answers**, and those two things are connected by **questions**.


```{r schema, echo = F}
my_edge_length <- .09
my_text_size <- 1.3
openplotmat()
pos <- coordinates(c(3))
question <- straightarrow(from = pos[1,], to = pos[3,])
text(question[1], question[2]+ .05, 'Questions')
textellipse(mid = pos[1,], radx = my_edge_length, lab = 'People', box.col = 'lightgrey')
textellipse(mid = pos[3,], radx = my_edge_length, lab = 'Answers', box.col = 'orange')
title('Data Viz Survey Schema')
```

The two questions I want to answer by exploring this graph is:

1. What can we learn from the people who spend less than 5% of their time on data visualization, but claim that data visualization is a primary focus of their work? (Inspired by Shirley Wu's closing comments in [655 Frustrations Doing Data Visualization](https://medium.com/visualizing-the-field/655-frustrations-doing-data-visualization-e1087c8176fc))
2. Who are people similar to me in the datavisualization community?

## Setup

### Packages

The packages we will need are **Tidyverse**, **stringr**, and **igraph**. I added the [igraph helper functions from my last post](./playing_with_graphs_4.html) to my package [tinkR](https://github.com/beemyfriend/tinkR). 

```{R loadPackages, eval = F}
packages <- c('tidyverse', 'stringr', 'igraph', 'tinkR')
sapply(packages, library, character.only = T)
```

### Data

The original data can be found in [Elijah Meeks github repository](https://github.com/emeeks/data_visualization_survey/tree/master/data). However, because we will work with a different version of the same dataset. I took the liberty and "graph-it-ized" (or "net-worked", or "node-and-edgitized") the csv so we can explore the survey results as we would a graph database.  You can find the "graph-ee-teed" dataset [in my github repository](https://github.com/beemyfriend/beemyfriend.github.io/blob/master/Data/data_vis_survey.graphml)


```{R loadData, eval = F}
g <- read_graph("Data/data_vis_survey.graphml", 'graphml')
```


## Test Example

Before we dive into the graph, we should try out a test case. 

```{r tExample}
#I want to know who gave the same answers as I did for a question
same_answers <- g %>%
  #find all edges
  E() %>%
  #filter edges that represent the question i'm interested in
  .[type == 'What technologies do you use to visualize data?'] %>%
  #create a subgraph from those edges
  reverse_subgraph_edges(g) %>%
  #save the subgraph for future reference
  save_as('question_net') %>%
  #find all edges of the subgraph
  E() %>%
  #filter edges that point towards my answers
  .[V(question_net) %->% V(question_net)[names(V(question_net)) %in% c("D3", 
                                                                       "Other Javascript", 
                                                                       "Other R", 
                                                                       "Inkscape", 
                                                                       "ggplot", 
                                                                       'Javascript',
                                                                       "JavaScript", 
                                                                       "R Shiny", 
                                                                       "R")]] %>%
  #produce a graph of people who gave the same answers as me
  reverse_subgraph_edges(question_net)
```

Let's see which one of my answers is the most common within the data visualization community.

```{r testDegree}
same_answers %>%
  #find the number of 'in' edges each node has
  #only answers in this graph have 'in' edges
  degree(mode = 'in') %>%
  #because people don't have 'in' edges they get a degree of 0
  .[. > 0] %>%
  #let's sort the results for cleanliness
  sort(T)
```

We will need to filter the graph multiple times to find people who responded to particular questions in a particular way. So let's wrap this task in a function we can use:

```{r getSameAnswers}
getSameAnswers <- function(graph, question, answerVect){
  graph %>%
    E() %>%
    .[type == question] %>%
    reverse_subgraph_edges(graph) %>%
    save_as('question_net') %>%
    E() %>%
    .[V(question_net) %->% V(question_net)[names(V(question_net)) %in% answerVect]] %>%
    reverse_subgraph_edges(question_net)
}
```

## My Answers to Survey Question

```{r myAnswers, results='hide'}
my_survey_responses <- tibble(
  questions = c(
    "What's your employment status",
    "How many years have you been doing data visualization?",
    "Is your total compensation in-line with Software Engineers and UX/UI/Designer roles at your level?",
    "Where do you live?",
    "How did you learn to create data visualization?",
    "Is this your first job doing data visualization?",
    "What is your educational background?",
    "What’s your ethnicity?",
    "What focus is data visualization in your work?",
    "Do you want to spend more time or less time visualizing data in the future?",
    "Age",
    "The organization you work for is in which of the following?",
    "Gender",
    "What technologies do you use to visualize data?",
    "Did you set out to work in data visualization or did you fall into it?"
  ),
  answers = list(
    c("Full-time"),
    c("1", "2"),
    c("Data Visualization Role has Lower compensation"),
    c("USA or Canada"),
    c("Mostly Self-Taught"),
    c("Yes"),
    c("Bachelors"), 
    c("white", "hispanic"),
    c("Data visualization is the focus of my job"),
    c("Much more"),
    c("26 - 35"),
    c("Mixed"),
    c('male'),
    c("D3", "Other Javascript", "Other R", "Inkscape", "ggplot", "JavaScript", "R Shiny", "R"),
    c('Intended to work in data visualization')
  )
)
```

## Filtering the network for those who are like me

```{r createSubnetworks}
#create subnetworks of people who answered questions as I did
same_answers <- lapply(seq_along(my_survey_responses$questions), function(i){
  getSameAnswers(g,
                 my_survey_responses$questions[i],
                 my_survey_responses$answers[[i]])
})
```

```{r createEdges}
edges <- lapply(same_answers, function(x){
  el <- x %>%
    #creates  matrix with source in first column and target in second column
    ends(E(.)) %>%
    as.tibble() %>%
    mutate(type = x %>% E() %>% .$type %>% .[1]) %>%
    rename(source = V1,
           target = V2)})%>%
  bind_rows()

networkLikeMe <- graph_from_data_frame(edges)
```

```{r findPeopleDegree}
networkLikeMe %>%
  degree(mode = 'out') %>%
  .[.>0] %>%
  sort(T) %>%
  head(10)
```

```{r fullNetwokr}
networkLikeMe_full <- networkLikeMe %>%
  V() %>%
  .[degree(networkLikeMe, mode = 'out') >= 12] %>%
  names() %>%
  save_as('peopleLikeMe') %>%
  smooth_transition(networkLikeMe) %>%
  E() %>%
  .[peopleLikeMe %->% V(networkLikeMe)] %>%
  reverse_subgraph_edges(networkLikeMe)
```

```{r peopleLikeMe}
peopleLikeMe
```

```{r peopleLikeMeFull}
peopleLikeMe_full <- peopleLikeMe %>%
  reverse_ego(g, 1) %>%
  unlist %>%
  names() %>% 
  unique %>%
  reverse_induced_subgraph(g)
```

```{r jobTitle}
peopleLikeMe_full %>%
  E() %>%
  .[type == "What is your official job title?" ] %>%
  reverse_subgraph_edges(peopleLikeMe_full) %>%
  degree(mode = 'in') %>%
  .[. > 0] %>%
  sort(T)
```

```{r}
whatTheySaid <- function(g, question){
  g %>%
    E() %>%
    .[type == question] %>%
    reverse_subgraph_edges(g) %>%
    degree(mode = 'in') %>%
    .[.> 0] %>%
    sort(T)
}
```

```{r}
questions <- g %>%
  E() %>%
  .$type %>%
  unique

similarAnswers <- lapply(questions, function(x){
  q <- x
  a <- whatTheySaid(peopleLikeMe_full, x)
  list(
    question = q,
    answers = a
  )})

names(similarAnswers) <- sapply(similarAnswers, function(x){x$question})

similarAnswers <- lapply(similarAnswers, function(x){x$answers})
```

```{r howDidTheyAnswer}
similarAnswers$`Who do you look to as a thought leader in data visualization?`
similarAnswers$`Who do you make data visualizations for?`
similarAnswers$`Which of these charts have you used in production in the last 6 months:`
similarAnswers$`What technologies do you use to visualize data?`
```

## What do people like me dislike about the people they work for?

```{r }
similarAnswers$`What is your biggest frustration with your job?` %>% names
similarAnswers$`What do you think other people in your organization just don’t get about the data visualization work that you do?` %>% names
similarAnswers$`What one change would make your job better?` %>% names
similarAnswers$`What is your biggest frustration with doing data visualization in your job?` %>% names
```
## What do people like me want to improve about themselves and the community?

```{r }
similarAnswers$`If you could change one thing about your data visualization work what would it be?` %>% names
similarAnswers$`What community support / discussions / advice would you want to see from data visualization thought leaders?` %>% names
```


## Shirley's question

```{r sxywuQ}
lt5_dv <- getSameAnswers(g, 
               "Percent of your day focused on creating/implementing/productizing data visualizations?",
               as.character(0:5) ) %>%
  V() %>%
  .[type == 'person'] %>%
  names()

pfocus <- getSameAnswers(g,
                         "What focus is data visualization in your work?",
                         "Data visualization is the focus of my job") %>%
  V() %>%
  .[type == 'person'] %>%
  names()

dataViz_atrophy <- lt5_dv %>% 
  .[. %in% pfocus] %>%
  reverse_ego(g) %>%
  unlist %>%
  names() %>% 
  unique %>%
  reverse_induced_subgraph(g)

dataViz_atrophy_answers <- questions %>%
  lapply(function(x){
    q = x
    a = whatTheySaid(dataViz_atrophy, x)
    list(question = q, answer = a)
  })

names(dataViz_atrophy_answers) <- sapply(dataViz_atrophy_answers, function(x){x$question})

dataViz_atrophy_answers <- lapply(dataViz_atrophy_answers, function(x){
  x$answer
}) 
```

```{r}
dataViz_atrophy_answers$`Are data visualization specialists represented in the leadership of your organization?`
dataViz_atrophy_answers$`Data visualization roles at your organization are found in what part of the organization?`
dataViz_atrophy_answers$`What level of data visualizations are used at your organization?`
dataViz_atrophy_answers$`How is your organization using data visualization?`
dataViz_atrophy_answers$`What's your employment status`
dataViz_atrophy_answers$`What is your official job title`
dataViz_atrophy_answers$`How many years have you been doing data visualization?`
dataViz_atrophy_answers$`What is your biggest frustration with your job?`
dataViz_atrophy_answers$`What do you think other people in your organization just don’t get about the data visualization work that you do?`
dataViz_atrophy_answers$`What community support / discussions / advice would you want to see from data visualization thought leaders?`
dataViz_atrophy_answers$`What do you think other people in your organization just don’t get about the data visualization work that you do?`
```
