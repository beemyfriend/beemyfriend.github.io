---
title: 'Playing With Graphs 5: Surveys'
author: "beemyfriend"
date: "January 20, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages <- c('tidyverse', 'stringr', 'igraph', 'tinkR')
sapply(packages, library, character.only = T)
g <- read_graph("../Data/data_vis_survey.graphml", 'graphml')
```

## Introduction

## Setup

### Packages

The packages we will need are **Tidyverse**, **stringr**, and **igraph**. I added the [igraph helper functions from my last post](./playing_with_graphs_4.html) to my package [tinkR](https://github.com/beemyfriend/tinkR). 

```{R loadPackages, eval = F}
packages <- c('tidyverse', 'stringr', 'igraph', 'tinkR')
sapply(packages, library, character.only = T)
```

### Data

The original data can be found in [Elijah Meeks github repository](https://github.com/emeeks/data_visualization_survey/tree/master/data). However, because we will work with a different version of the same dataset. I took the liberty and "graph-it-ize" (or "net-worked", or "node-and-edgitized") the csv so we can explore the survey results as we would a graph database.  You can find the "graph-ee-teed" dataset [in my github repository](https://github.com/beemyfriend/beemyfriend.github.io/blob/master/Data/data_vis_survey.graphml)


```{R loadData, eval = F}
g <- read_graph("Data/data_vis_survey.graphml", 'graphml')
```

### Graph Schema

## Test Example

```{r tExample}
#I want to know who gave the same answers as I did for a question
same_answers <- g %>%
  #find all edges
  E() %>%
  #filter edges that represent the question i'm interested in
  .[type == 'What technologies do you use to visualize data?'] %>%
  #create a subgraph from those edges
  reverse_subgraph_edges(g) %>%
  #save the subgraph for future reference
  save_as('question_net') %>%
  #find all edges of the subgraph
  E() %>%
  #filter edges that point towards my answers
  .[V(question_net) %->% V(question_net)[names(V(question_net)) %in% c("D3", 
                                                                       "Other Javascript", 
                                                                       "Other R", 
                                                                       "Inkscape", 
                                                                       "ggplot", 
                                                                       'Javascript',
                                                                       "JavaScript", 
                                                                       "R Shiny", 
                                                                       "R")]] %>%
  #produce a graph of people who gave the same answers as me
  reverse_subgraph_edges(question_net)
```

Let's see which one of my answers is the most common within the data visualization community.

```{r testDegree}
same_answers %>%
  #find the number of 'in' edges each node has
  #only answers in this graph have 'in' edges
  degree(mode = 'in') %>%
  #because people don't have 'in' edges they get a degree of 0
  .[. > 0] %>%
  #let's sort the results for cleanliness
  sort(T)
```

We will need to filter the graph multiple times to find people who responded to particular questions in a particular way. So let's wrap this task in a function we can use:

```{r getSameAnswers}
getSameAnswers <- function(graph, question, answerVect){
  graph %>%
    E() %>%
    .[type == question] %>%
    reverse_subgraph_edges(graph) %>%
    save_as('question_net') %>%
    E() %>%
    .[V(question_net) %->% V(question_net)[names(V(question_net)) %in% answerVect]] %>%
    reverse_subgraph_edges(question_net)
}
```

## My Answers to Survey Question

```{r myAnswers, results='hide'}
my_survey_responses <- tibble(
  questions = c(
    "What's your employment status",
    "How many years have you been doing data visualization?",
    "Is your total compensation in-line with Software Engineers and UX/UI/Designer roles at your level?",
    "Where do you live?",
    "How did you learn to create data visualization?",
    "Is this your first job doing data visualization?",
    "What is your educational background?",
    "Whatâ€™s your ethnicity?",
    "What focus is data visualization in your work?",
    "Do you want to spend more time or less time visualizing data in the future?",
    "Age",
    "The organization you work for is in which of the following?",
    "Gender",
    "What technologies do you use to visualize data?",
    "Did you set out to work in data visualization or did you fall into it?"
  ),
  answers = list(
    c("Full-time"),
    c("1", "2"),
    c("Data Visualization Role has Lower compensation"),
    c("USA or Canada"),
    c("Mostly Self-Taught"),
    c("Yes"),
    c("Bachelors"), 
    c("white", "hispanic"),
    c("Data visualization is the focus of my job"),
    c("Much more"),
    c("26 - 35"),
    c("Mixed"),
    c('male'),
    c("D3", "Other Javascript", "Other R", "Inkscape", "ggplot", "JavaScript", "R Shiny", "R"),
    c('Intended to work in data visualization')
  )
)
```

## Filtering the network for those who are like me

```{r createSubnetworks}
#create subnetworks of people who answered questions as I did
same_answers <- lapply(seq_along(my_survey_responses$questions), function(i){
  getSameAnswers(g,
                 my_survey_responses$questions[i],
                 my_survey_responses$answers[[i]])
})
```

```{r createEdges}
edges <- lapply(same_answers, function(x){
  el <- x %>%
    #creates  matrix with source in first column and target in second column
    ends(E(.)) %>%
    as.tibble() %>%
    mutate(type = x %>% E() %>% .$type %>% .[1]) %>%
    rename(source = V1,
           target = V2)})%>%
  bind_rows()

networkLikeMe <- graph_from_data_frame(edges)
```

```{r findPeopleDegree}
networkLikeMe %>%
  degree(mode = 'out') %>%
  .[.>0] %>%
  sort(T) %>%
  head(10)
```